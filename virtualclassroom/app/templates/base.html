<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" id="bootstrap-css">
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
    <script type="application/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="application/javascript" src="//stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}">
    <title>OneSchool</title>
</head>
<body class="d-flex flex-column">
  <!-- Header -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container">
      {% if user.is_authenticated %}
        <a class="navbar-brand" href="/">{{user.active_registration.institution.name}}</a>
      {% else %}
        <a class="navbar-brand" href="/">OneSchool</a>
      {% endif %}
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link" href="/dashboard">Dashboard</a>
            </li>
            {% if request.session.role != 'RO' %}
              <li class="nav-item">
                <a class="nav-link" href="/upload">Upload</a>
              </li>
            {% endif %}
            {% if registrations|length > 1 %}
              <li class="nav-item">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#switchaccountmodal">Change Account</a>
              </li>
            {% endif %}
            <li class="nav-item active">
              <a class="nav-link" href="/logout">Logout<span class="sr-only">(current)</span></a>
            </li>
          {% else %}
            <li class="nav-item">
              <a class="nav-link" href="/login">Login</a>
            </li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>
  <!-- Body -->
  <div id="page-content">
    {% if user.is_authenticated %}
      <div class="modal fade" id="switchaccountmodal" tabindex="-1" role="dialog" aria-labelledby="switchaccountmodalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Choose Account</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="switchaccountform" action="/switch-account/" method="post">
                {% csrf_token %}
                {% for reg in registrations %}
                  {% if reg.institution.id != user.active_registration.institution.id %}
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="institution_id" id="{{reg.institution.id}}" value="{{reg.institution.id}}">
                      <label class="form-check-label" for="{{reg.institution.id}}">{{ reg.institution.name }}</label>
                    </div>
                  {% endif %}
                {% endfor %}
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary" onclick="event.preventDefault();document.getElementById('switchaccountform').submit();">Save</button>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
    {% block content %}{% endblock %}
  </div>
</body>
</html>
